<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="video-text.css" />
    <link rel="icon" href="image/favicon.png" type="image/png" sizes="32x32" />
    <title>Vidéo dans le Texte - Alternative</title>
  </head>

  <body>
    <div class="container">
      <a
        id="event"
        href="https://projetevenement.netlify.app/"
        target="_blank"
        class="button-link"
        >Evenement & Co</a
      >

      <a
        id="ink"
        href="https://inkpulse.netlify.app/"
        target="_blank"
        class="button-link"
        >Ink Pulse</a
      >
      <a id="devine" href="" target="_blank" class="button-link"
        >devine le nombre</a
      >
    </div>

    <div class="link">
      <h2 id="name">Chrystelle Albina</h2>

      <a href="index.html"><img src="/image/accueil.webp" alt="" /></a>
      <a href="https://github.com/ChrystelleALBINA" target="_blank"
        ><img src="/image/github.png" alt="logo cliquable github"
      /></a>
      <a
        href="https://www.linkedin.com/in/chrystelle-albina-8509a944/"
        target="_blank"
        ><img src="/image/linkedin .png" alt="logo cliquable linkedin"
      /></a>
    </div>

    <footer>
      <p>&copy; 2025 Portfolio Chrystelle Albina. All rights reserved.</p>
    </footer>

    <!-- Plusieurs sources vidéo pour plus de fiabilité -->
    <video
      id="backgroundVideo"
      style="display: none"
      autoplay
      muted
      loop
      playsinline
    >
      <source
        src="https://cdn.coverr.co/videos/coverr-waves-crashing-on-the-shore-694/1080p.mp4"
        type="video/mp4"
      />
      <source
        src="https://sample-videos.com/zip/10/mp4/SampleVideo_1280x720_1mb.mp4"
        type="video/mp4"
      />
      <source
        src="https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4"
        type="video/mp4"
      />
    </video>

    <canvas id="videoCanvas" style="display: none"></canvas>
  </body>

  <script>
    // Fonction pour capturer la vidéo et l'appliquer comme arrière-plan du texte
    function setupVideoBackground() {
      const video = document.getElementById("backgroundVideo");
      const canvas = document.getElementById("videoCanvas");
      const ctx = canvas.getContext("2d");
      const nameElement = document.getElementById("name");

      // Fonction de secours avec dégradé animé
      function fallbackAnimation() {
        console.log("Utilisation de l'animation de secours");
        nameElement.style.backgroundImage =
          "linear-gradient(45deg, #667eea, #764ba2, #f093fb, #f5576c, #4facfe, #00f2fe)";
        nameElement.style.backgroundSize = "400% 400%";
        nameElement.style.animation = "gradientShift 4s ease infinite";
        nameElement.style.backgroundClip = "text";
        nameElement.style.webkitBackgroundClip = "text";
        nameElement.style.color = "transparent";
      }

      // Fonction pour appliquer l'image du canvas au texte
      function applyVideoToText() {
        try {
          if (video.readyState === video.HAVE_ENOUGH_DATA) {
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

            const imageUrl = canvas.toDataURL("image/jpeg", 0.8);

            nameElement.style.backgroundImage = `url(${imageUrl})`;
            nameElement.style.backgroundSize = "cover";
            nameElement.style.backgroundPosition = "center";
            nameElement.style.backgroundClip = "text";
            nameElement.style.webkitBackgroundClip = "text";
            nameElement.style.color = "transparent";
            nameElement.style.animation = "none"; // Désactiver l'animation CSS
          }
        } catch (error) {
          console.error("Erreur lors du traitement de la vidéo:", error);
          fallbackAnimation();
        }
      }

      // Configuration du canvas
      function setupCanvas() {
        canvas.width = 640;
        canvas.height = 360;
        console.log("Canvas configuré:", canvas.width, "x", canvas.height);
      }

      // Gestion des événements vidéo
      video.addEventListener("loadeddata", function () {
        console.log("Vidéo chargée avec succès");
        setupCanvas();

        // Démarrer la capture vidéo
        function captureVideo() {
          applyVideoToText();
          requestAnimationFrame(captureVideo);
        }

        captureVideo();
      });

      // Gestion des erreurs
      video.addEventListener("error", function (e) {
        console.error("Erreur de chargement de la vidéo:", e);
        fallbackAnimation();
      });

      // Timeout pour détecter si la vidéo ne charge pas
      setTimeout(() => {
        if (video.readyState < 2) {
          console.log("Vidéo non chargée, utilisation du fallback");
          fallbackAnimation();
        }
      }, 3000);

      // Démarrer la vidéo avec gestion d'erreur
      video.play().catch((error) => {
        console.error("Impossible de lire la vidéo:", error);
        fallbackAnimation();
      });

      // Ajouter un bouton pour tester manuellement
      const testButton = document.createElement("button");
      testButton.textContent = "Test Vidéo";
      testButton.style.position = "fixed";
      testButton.style.top = "10px";
      testButton.style.right = "10px";
      testButton.style.zIndex = "1000";
      testButton.onclick = () => {
        if (video.readyState >= 2) {
          applyVideoToText();
        } else {
          fallbackAnimation();
        }
      };
      document.body.appendChild(testButton);
    }

    // Initialiser quand la page est chargée
    window.addEventListener("load", setupVideoBackground);
  </script>
</html>
